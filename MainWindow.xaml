<Window x:Class="RollingCounterCheck.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RollingCounterCheck"
        mc:Ignorable="d"
        Title="RollingCounterCheck" Height="450" Width="800">

    <Window.Resources>
        <CollectionViewSource x:Key="SortedMessages"
                              Source="{Binding Messages}">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="CanId"
                                     Direction="Ascending"/>
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>

        <local:BoolToColorConverter x:Key="BoolToColorConverter"/>
    </Window.Resources>

    <DockPanel Margin="10">

        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Datei">
                <MenuItem Header="_Beenden" Click="MenuFileExit_Click"/>
            </MenuItem>

            <MenuItem Header="_CAN">
                <MenuItem Header="Datenrate">
                    <MenuItem Header="125 kbit/s" Click="MenuCanBaud_Click" Tag="125"/>
                    <MenuItem Header="250 kbit/s" Click="MenuCanBaud_Click" Tag="250"/>
                    <MenuItem Header="500 kbit/s" Click="MenuCanBaud_Click" Tag="500"/>
                    <MenuItem Header="1000 kbit/s" Click="MenuCanBaud_Click" Tag="1000"/>
                </MenuItem>
            </MenuItem>

            <MenuItem Header="_Hilfe"/>
        </Menu>

        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding BusLoadPercent,
                          StringFormat=Busload: {0:F1} %}" />
            </StatusBarItem>

            <StatusBarItem>
                <TextBlock Text="{Binding CanBaudrateKbps,
                          StringFormat=CAN Baudrate: {0} kbit/s}" />
            </StatusBarItem>

            <StatusBarItem>
                <Ellipse Width="16" Height="16" Stroke="Black" StrokeThickness="1">
                    <Ellipse.Fill>
                        <SolidColorBrush Color="{Binding LedVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    </Ellipse.Fill>
                </Ellipse>
            </StatusBarItem>
        </StatusBar>

        <DataGrid ItemsSource="{Binding Source={StaticResource SortedMessages}}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False">
            <DataGrid.Columns>
                <DataGridCheckBoxColumn Header="Log"
                                        Binding="{Binding LogToCsv}" />
                <DataGridTextColumn Header="CAN ID"
                                    Binding="{Binding CanId,
                                              StringFormat=0x{0:X}}" />
                <DataGridTextColumn Header="DLC"
                                    Binding="{Binding DLC}" />
                <DataGridTextColumn Header="Payload"
                                    Binding="{Binding Payload}" />
                <DataGridTextColumn Header="CycleTime [ms]"
                                    Binding="{Binding CycleTimeMs,
                                              StringFormat=F1}" />
                <DataGridTextColumn Header="Counter"
                                    Binding="{Binding Counter}" />
            </DataGrid.Columns>
        </DataGrid>

    </DockPanel>
</Window>
